var f=require("http"),c=require("express"),p=require("fs"),i=require("socket.io"),h=require("crypto"),n=c(),m=c.static,l=f.createServer(n);i=i(l);var o={port:process.env.PORT||1948,baseDir:__dirname+"/../../"};i.on("connection",function(r){r.on("multiplex-statechanged",function(e){typeof e.secret=="undefined"||e.secret==null||e.secret===""||u(e.secret)===e.socketId&&(e.secret=null,r.broadcast.emit(e.socketId,e))})}),["css","js","plugin","lib"].forEach(function(r){n.use("/"+r,m(o.baseDir+r))}),n.get("/",function(r,e){e.writeHead(200,{"Content-Type":"text/html"});var t=p.createReadStream(o.baseDir+"/index.html");t.on("error",function(s){e.write('<style>body{font-family: sans-serif;}</style><h2>reveal.js multiplex server.</h2><a href="/token">Generate token</a>'),e.end()}),t.on("readable",function(){t.pipe(e)})}),n.get("/token",function(r,e){var t=new Date().getTime(),s=Math.floor(Math.random()*9999999),a=t.toString()+s.toString();e.send({secret:a,socketId:u(a)})});var u=function(r){var e=h.createCipher("blowfish",r);return e.final("hex")};l.listen(o.port||null);var g="\x1B[33m",b="\x1B[32m",v="\x1B[0m";console.log(g+"reveal.js:"+v+" Multiplex running on port "+b+o.port+v);
