{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"moment\"","webpack:///./public/js/lib/common/login.js","webpack:///./public/js/lib/config/index.js","webpack:///./public/js/history.js","webpack:///./public/js/utils.js","webpack:///./public/js/fix-aria-hidden-for-modals.js","webpack:///external \"$\"","webpack:///./public/js/locale.js","webpack:///./public/css/site.css?cc32","webpack:///./public/js/cover.js","webpack:///./public/css/cover.css?f654"],"names":["webpackJsonpCallback","data","chunkIds","moreModules","executeModules","moduleId","chunkId","i","resolves","installedChunks","modules","parentJsonpFunction","deferredModules","checkDeferredModules","result","deferredModule","fulfilled","j","depId","__webpack_require__","installedModules","module","exports","name","getter","value","mode","ns","key","object","property","jsonpArray","oldJsonpFunction","setloginStateChangeEvent","resetCheckAuth","setLoginState","checkLoginStateChanged","getLoginState","getUserId","clearLoginState","checkIfAuth","checkAuth","profile","lastLoginState","lastUserId","loginStateChangeEvent","func","bool","id","Cookies","set","expires","sameSite","window","cookiePolicy","secure","location","protocol","remove","setTimeout","state","get","yesCallback","noCallback","cookieLoginState","$","serverurl","done","status","fail","always","DROPBOX_APP_KEY","domain","urlpath","debug","port","hostname","noteid","decodeURIComponent","pathname","slice","length","split","noteurl","version","saveHistory","saveStorageHistoryToServer","clearDuplicatedHistory","removeHistory","writeHistory","getHistory","getStorageHistory","parseHistory","parseServerToHistory","parseStorageToHistory","postHistoryToServer","deleteServerHistory","migrateHistoryFromTempCallback","migrateHistoryFromTemp","tempid","temp","olddata","saveHistoryToStorage","JSON","parse","hash","indexOf","splice","join","notehistory","saveHistoryToServer","store","post","history","callback","newnotehistory","found","replace","newId","time","moment","newTime","push","addHistory","text","tags","pinned","title","writeHistoryToStorage","generateHistory","Array","isArray","arg","Object","prototype","toString","call","renderHistory","valueOf","info","getServerHistory","xhr","error","console","responseText","list","parseToHistory","LZString","decompressFromBase64","err","timestamp","fromNow","format","escapeHTML","s","add","noteId","ajax","url","type","checkNoteIdValid","encodeNoteId","decodeNoteId","uuidRegex","match","str","hexStr","Buffer","from","base64url","encode","encodedId","toBuffer","idParts","substr","document","on","event","target","attr","supportedLanguages","require","detectLang","lang","userLang","navigator","language","userLanguage","userLangCode","supportedLanguagesList","includes","localeSelector","forEach","isoCode","nativeName","append","val","change","reload","locale","options","valueNames","item","page","pagination","outerWindow","historyList","List","pageInit","hide","show","photo","prop","html","click","parseHistoryCallback","siblings","removeClass","addClass","e","preventDefault","is","fadeIn","checkHistoryList","children","slideDown","items","sort","sortFunction","a","b","notea","values","noteb","filtertags","l","_values","buildTagsFilter","visible","itemEl","elm","find","pin","tagsEl","labels","off","historyCloseClick","historyPinClick","closest","clearHistory","deleteId","$this","setInterval","updateItemFromNow","toArray","parseInt","deleteHistory","clear","modal","blob","Blob","bind","files","dataTransfer","file","reader","FileReader","onload","mergedata","concat","replaceWith","clone","readAsText","lastTags","select2","filter","lastKeyword","search","slideUp","trigger","parent","href","placeholder","multiple","results","css","unescapeHTML","keyup","fieldLDAP","fieldEmail","fieldOpenID","focus"],"mappings":"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","file":"cover.c4a79926a5ed549e6b1a.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t6: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"build/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([688,0,4]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = moment;","/* global Cookies */\n\nimport { serverurl } from '../config'\n\nlet checkAuth = false\nlet profile = null\nlet lastLoginState = getLoginState()\nlet lastUserId = getUserId()\nlet loginStateChangeEvent = null\n\nexport function setloginStateChangeEvent (func) {\n  loginStateChangeEvent = func\n}\n\nexport function resetCheckAuth () {\n  checkAuth = false\n}\n\nexport function setLoginState (bool, id) {\n  Cookies.set('loginstate', bool, {\n    expires: 365,\n    sameSite: window.cookiePolicy,\n    secure: window.location.protocol === 'https:'\n  })\n  if (id) {\n    Cookies.set('userid', id, {\n      expires: 365,\n      sameSite: window.cookiePolicy,\n      secure: window.location.protocol === 'https:'\n    })\n  } else {\n    Cookies.remove('userid', {\n      sameSite: window.cookiePolicy,\n      secure: window.location.protocol === 'https:'\n    })\n  }\n  lastLoginState = bool\n  lastUserId = id\n  checkLoginStateChanged()\n}\n\nexport function checkLoginStateChanged () {\n  if (getLoginState() !== lastLoginState || getUserId() !== lastUserId) {\n    if (loginStateChangeEvent) setTimeout(loginStateChangeEvent, 100)\n    return true\n  } else {\n    return false\n  }\n}\n\nexport function getLoginState () {\n  const state = Cookies.get('loginstate')\n  return state === 'true' || state === true\n}\n\nexport function getUserId () {\n  return Cookies.get('userid')\n}\n\nexport function clearLoginState () {\n  Cookies.remove('loginstate')\n}\n\nexport function checkIfAuth (yesCallback, noCallback) {\n  const cookieLoginState = getLoginState()\n  if (checkLoginStateChanged()) checkAuth = false\n  if (!checkAuth || typeof cookieLoginState === 'undefined') {\n    $.get(`${serverurl}/me`)\n      .done(data => {\n        if (data && data.status === 'ok') {\n          profile = data\n          yesCallback(profile)\n          setLoginState(true, data.id)\n        } else {\n          noCallback()\n          setLoginState(false)\n        }\n      })\n      .fail(() => {\n        noCallback()\n      })\n      .always(() => {\n        checkAuth = true\n      })\n  } else if (cookieLoginState) {\n    yesCallback(profile)\n  } else {\n    noCallback()\n  }\n}\n\nexport default {\n  checkAuth,\n  profile,\n  lastLoginState,\n  lastUserId,\n  loginStateChangeEvent\n}\n","export const DROPBOX_APP_KEY = window.DROPBOX_APP_KEY || ''\n\nexport const domain = window.domain || '' // domain name\nexport const urlpath = window.urlpath || '' // sub url path, like: www.example.com/<urlpath>\nexport const debug = window.debug || false\n\nexport const port = window.location.port\nexport const serverurl = `${window.location.protocol}//${domain || window.location.hostname}${port ? ':' + port : ''}${urlpath ? '/' + urlpath : ''}`\nwindow.serverurl = serverurl\nexport const noteid = decodeURIComponent(urlpath ? window.location.pathname.slice(urlpath.length + 1, window.location.pathname.length).split('/')[1] : window.location.pathname.split('/')[1])\nexport const noteurl = `${serverurl}/${noteid}`\n\nexport const version = window.version\n","/* eslint no-console: [\"error\", { allow: [\"warn\", \"error\", \"debug\"] }] */\n/* global serverurl, moment */\n\nimport store from 'store'\nimport S from 'string'\nimport LZString from 'lz-string'\nimport url from 'wurl'\n\nimport {\n  checkNoteIdValid,\n  encodeNoteId\n} from './utils'\n\nimport {\n  checkIfAuth\n} from './lib/common/login'\n\nimport {\n  urlpath\n} from './lib/config'\n\nwindow.migrateHistoryFromTempCallback = null\n\nmigrateHistoryFromTemp()\n\nfunction migrateHistoryFromTemp () {\n  if (url('#tempid')) {\n    $.get(`${serverurl}/temp`, {\n      tempid: url('#tempid')\n    })\n      .done(data => {\n        if (data && data.temp) {\n          getStorageHistory(olddata => {\n            if (!olddata || olddata.length === 0) {\n              saveHistoryToStorage(JSON.parse(data.temp))\n            }\n          })\n        }\n      })\n      .always(() => {\n        let hash = location.hash.split('#')[1]\n        hash = hash.split('&')\n        for (let i = 0; i < hash.length; i++) {\n          if (hash[i].indexOf('tempid') === 0) {\n            hash.splice(i, 1)\n            i--\n          }\n        }\n        hash = hash.join('&')\n        location.hash = hash\n        if (window.migrateHistoryFromTempCallback) { window.migrateHistoryFromTempCallback() }\n      })\n  }\n}\n\nexport function saveHistory (notehistory) {\n  checkIfAuth(\n    () => {\n      saveHistoryToServer(notehistory)\n    },\n    () => {\n      saveHistoryToStorage(notehistory)\n    }\n  )\n}\n\nfunction saveHistoryToStorage (notehistory) {\n  store.set('notehistory', JSON.stringify(notehistory))\n}\n\nfunction saveHistoryToServer (notehistory) {\n  $.post(`${serverurl}/history`, {\n    history: JSON.stringify(notehistory)\n  })\n}\n\nexport function saveStorageHistoryToServer (callback) {\n  const data = store.get('notehistory')\n  if (data) {\n    $.post(`${serverurl}/history`, {\n      history: data\n    })\n      .done(data => {\n        callback(data)\n      })\n  }\n}\n\nexport function clearDuplicatedHistory (notehistory) {\n  const newnotehistory = []\n  for (let i = 0; i < notehistory.length; i++) {\n    let found = false\n    for (let j = 0; j < newnotehistory.length; j++) {\n      const id = notehistory[i].id.replace(/=+$/, '')\n      const newId = newnotehistory[j].id.replace(/=+$/, '')\n      if (id === newId || notehistory[i].id === newnotehistory[j].id || !notehistory[i].id || !newnotehistory[j].id) {\n        const time = (typeof notehistory[i].time === 'number' ? moment(notehistory[i].time) : moment(notehistory[i].time, 'MMMM Do YYYY, h:mm:ss a'))\n        const newTime = (typeof newnotehistory[i].time === 'number' ? moment(newnotehistory[i].time) : moment(newnotehistory[i].time, 'MMMM Do YYYY, h:mm:ss a'))\n        if (time >= newTime) {\n          newnotehistory[j] = notehistory[i]\n        }\n        found = true\n        break\n      }\n    }\n    if (!found) { newnotehistory.push(notehistory[i]) }\n  }\n  return newnotehistory\n}\n\nfunction addHistory (id, text, time, tags, pinned, notehistory) {\n  // only add when note id exists\n  if (id) {\n    notehistory.push({\n      id,\n      text,\n      time,\n      tags,\n      pinned\n    })\n  }\n  return notehistory\n}\n\nexport function removeHistory (id, notehistory) {\n  for (let i = 0; i < notehistory.length; i++) {\n    if (notehistory[i].id === id) {\n      notehistory.splice(i, 1)\n      i -= 1\n    }\n  }\n  return notehistory\n}\n\n// used for inner\nexport function writeHistory (title, tags) {\n  checkIfAuth(\n    () => {\n      // no need to do this anymore, this will count from server-side\n      // writeHistoryToServer(title, tags);\n    },\n    () => {\n      writeHistoryToStorage(title, tags)\n    }\n  )\n}\n\nfunction writeHistoryToStorage (title, tags) {\n  const data = store.get('notehistory')\n  let notehistory\n  if (data && typeof data === 'string') {\n    notehistory = JSON.parse(data)\n  } else {\n    notehistory = []\n  }\n\n  const newnotehistory = generateHistory(title, tags, notehistory)\n  saveHistoryToStorage(newnotehistory)\n}\n\nif (!Array.isArray) {\n  Array.isArray = arg => Object.prototype.toString.call(arg) === '[object Array]'\n}\n\nfunction renderHistory (title, tags) {\n  // console.debug(tags);\n  const id = urlpath ? location.pathname.slice(urlpath.length + 1, location.pathname.length).split('/')[1] : location.pathname.split('/')[1]\n  return {\n    id,\n    text: title,\n    time: moment().valueOf(),\n    tags\n  }\n}\n\nfunction generateHistory (title, tags, notehistory) {\n  const info = renderHistory(title, tags)\n  // keep any pinned data\n  let pinned = false\n  for (let i = 0; i < notehistory.length; i++) {\n    if (notehistory[i].id === info.id && notehistory[i].pinned) {\n      pinned = true\n      break\n    }\n  }\n  notehistory = removeHistory(info.id, notehistory)\n  notehistory = addHistory(info.id, info.text, info.time, info.tags, pinned, notehistory)\n  notehistory = clearDuplicatedHistory(notehistory)\n  return notehistory\n}\n\n// used for outer\nexport function getHistory (callback) {\n  checkIfAuth(\n    () => {\n      getServerHistory(callback)\n    },\n    () => {\n      getStorageHistory(callback)\n    }\n  )\n}\n\nfunction getServerHistory (callback) {\n  $.get(`${serverurl}/history`)\n    .done(data => {\n      if (data.history) {\n        callback(data.history)\n      }\n    })\n    .fail((xhr, status, error) => {\n      console.error(xhr.responseText)\n    })\n}\n\nexport function getStorageHistory (callback) {\n  let data = store.get('notehistory')\n  if (data) {\n    if (typeof data === 'string') { data = JSON.parse(data) }\n    callback(data)\n  }\n\n  callback([])\n}\n\nexport function parseHistory (list, callback) {\n  checkIfAuth(\n    () => {\n      parseServerToHistory(list, callback)\n    },\n    () => {\n      parseStorageToHistory(list, callback)\n    }\n  )\n}\n\nexport function parseServerToHistory (list, callback) {\n  $.get(`${serverurl}/history`)\n    .done(data => {\n      if (data.history) {\n        parseToHistory(list, data.history, callback)\n      }\n    })\n    .fail((xhr, status, error) => {\n      console.error(xhr.responseText)\n    })\n}\n\nexport function parseStorageToHistory (list, callback) {\n  let data = store.get('notehistory')\n  if (data) {\n    if (typeof data === 'string') { data = JSON.parse(data) }\n    parseToHistory(list, data, callback)\n  }\n  parseToHistory(list, [], callback)\n}\n\nfunction parseToHistory (list, notehistory, callback) {\n  if (!callback) return\n  else if (!list || !notehistory) callback(list, notehistory)\n  else if (notehistory && notehistory.length > 0) {\n    for (let i = 0; i < notehistory.length; i++) {\n      // migrate LZString encoded id to base64url encoded id\n      try {\n        const id = LZString.decompressFromBase64(notehistory[i].id)\n        if (id && checkNoteIdValid(id)) {\n          notehistory[i].id = encodeNoteId(id)\n        }\n      } catch (err) {\n        console.error(err)\n      }\n      // parse time to timestamp and fromNow\n      const timestamp = (typeof notehistory[i].time === 'number' ? moment(notehistory[i].time) : moment(notehistory[i].time, 'MMMM Do YYYY, h:mm:ss a'))\n      notehistory[i].timestamp = timestamp.valueOf()\n      notehistory[i].fromNow = timestamp.fromNow()\n      notehistory[i].time = timestamp.format('llll')\n      // prevent XSS\n      notehistory[i].text = S(notehistory[i].text).escapeHTML().s\n      notehistory[i].tags = (notehistory[i].tags && notehistory[i].tags.length > 0) ? S(notehistory[i].tags).escapeHTML().s.split(',') : []\n      // add to list\n      if (notehistory[i].id && list.get('id', notehistory[i].id).length === 0) { list.add(notehistory[i]) }\n    }\n  }\n  callback(list, notehistory)\n}\n\nexport function postHistoryToServer (noteId, data, callback) {\n  $.post(`${serverurl}/history/${noteId}`, data)\n    .done(result => callback(null, result))\n    .fail((xhr, status, error) => {\n      console.error(xhr.responseText)\n      return callback(error, null)\n    })\n}\n\nexport function deleteServerHistory (noteId, callback) {\n  $.ajax({\n    url: `${serverurl}/history${noteId ? '/' + noteId : ''}`,\n    type: 'DELETE'\n  })\n    .done(result => callback(null, result))\n    .fail((xhr, status, error) => {\n      console.error(xhr.responseText)\n      return callback(error, null)\n    })\n}\n","import base64url from 'base64url'\n\nconst uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i\n\nexport function checkNoteIdValid (id) {\n  const result = id.match(uuidRegex)\n  if (result && result.length === 1) {\n    return true\n  } else {\n    return false\n  }\n}\n\nexport function encodeNoteId (id) {\n  // remove dashes in UUID and encode in url-safe base64\n  const str = id.replace(/-/g, '')\n  const hexStr = Buffer.from(str, 'hex')\n  return base64url.encode(hexStr)\n}\n\nexport function decodeNoteId (encodedId) {\n  // decode from url-safe base64\n  const id = base64url.toBuffer(encodedId).toString('hex')\n  // add dashes between the UUID string parts\n  const idParts = []\n  idParts.push(id.substr(0, 8))\n  idParts.push(id.substr(8, 4))\n  idParts.push(id.substr(12, 4))\n  idParts.push(id.substr(16, 4))\n  idParts.push(id.substr(20, 12))\n  return idParts.join('-')\n}\n","$(document).on('shown.bs.modal', function (event) {\n  $(event.target).attr('aria-hidden', 'false')\n}).on('hidden.bs.modal', function (event) {\n  $(event.target).attr('aria-hidden', 'true')\n})\n","module.exports = $;","/* global Cookies */\nconst supportedLanguages = require('../../locales/_supported.json')\n\nfunction detectLang () {\n  if (Cookies.get('locale')) {\n    let lang = Cookies.get('locale')\n    if (lang === 'zh') {\n      lang = 'zh-TW'\n    }\n    return lang\n  }\n  const userLang = navigator.language || navigator.userLanguage\n  const userLangCode = userLang.split('-')[0]\n  const supportedLanguagesList = Object.keys(supportedLanguages)\n  if (supportedLanguagesList.includes(userLangCode)) {\n    return userLangCode\n  } else if (supportedLanguagesList.includes(userLang)) {\n    return userLang\n  }\n  return 'en'\n}\n\nconst lang = detectLang()\nconst localeSelector = $('.ui-locale')\nObject.entries(supportedLanguages).forEach(function ([isoCode, nativeName]) {\n  localeSelector.append(`<option value=\"${isoCode}\">${nativeName}</option>`)\n})\n\n// the following condition is needed as the selector is only available in the intro/history page\nif (localeSelector.length > 0) {\n  localeSelector.val(lang)\n  $('select.ui-locale option[value=\"' + lang + '\"]').attr('selected', 'selected')\n  localeSelector.change(function () {\n    Cookies.set('locale', $(this).val(), {\n      expires: 365,\n      sameSite: window.cookiePolicy,\n      secure: window.location.protocol === 'https:'\n    })\n    window.location.reload()\n  })\n}\n\nwindow.moment.locale(lang)\n","// extracted by mini-css-extract-plugin\nexport {};","/* global moment, serverurl */\n\nimport {\n  checkIfAuth,\n  clearLoginState,\n  getLoginState,\n  resetCheckAuth,\n  setloginStateChangeEvent\n} from './lib/common/login'\n\nimport {\n  clearDuplicatedHistory,\n  deleteServerHistory,\n  getHistory,\n  getStorageHistory,\n  parseHistory,\n  parseServerToHistory,\n  parseStorageToHistory,\n  postHistoryToServer,\n  removeHistory,\n  saveHistory,\n  saveStorageHistoryToServer\n} from './history'\n\nimport { saveAs } from 'file-saver'\nimport List from 'list.js'\nimport S from 'string'\n\nrequire('./locale')\n\nrequire('../css/cover.css')\nrequire('../css/site.css')\n\nrequire('./fix-aria-hidden-for-modals')\n\nconst options = {\n  valueNames: ['id', 'text', 'timestamp', 'fromNow', 'time', 'tags', 'pinned'],\n  item: `<li class=\"col-xs-12 col-sm-6 col-md-6 col-lg-4\">\n          <span class=\"id\" style=\"display:none;\"></span>\n          <a href=\"#\">\n            <div class=\"item\">\n              <div class=\"ui-history-pin fa fa-thumb-tack fa-fw\"></div>\n              <div class=\"ui-history-close fa fa-close fa-fw\" data-toggle=\"modal\" data-target=\".delete-history-modal\"></div>\n              <div class=\"content\">\n                <h4 class=\"text\"></h4>\n                <p>\n                  <i><i class=\"fa fa-clock-o\"></i> visited </i><i class=\"fromNow\"></i>\n                  <br>\n                  <i class=\"timestamp\" style=\"display:none;\"></i>\n                  <i class=\"time\"></i>\n                </p>\n                <p class=\"tags\"></p>\n              </div>\n            </div>\n          </a>\n        </li>`,\n  page: 18,\n  pagination: [{\n    outerWindow: 1\n  }]\n}\nconst historyList = new List('history', options)\n\nwindow.migrateHistoryFromTempCallback = pageInit\nsetloginStateChangeEvent(pageInit)\n\npageInit()\n\nfunction pageInit () {\n  checkIfAuth(\n    data => {\n      $('.ui-signin').hide()\n      $('.ui-or').hide()\n      $('.ui-welcome').show()\n      if (data.photo) $('.ui-avatar').prop('src', data.photo).show()\n      else $('.ui-avatar').prop('src', '').hide()\n      $('.ui-name').html(data.name)\n      $('.ui-signout').show()\n      $('.ui-history').click()\n      parseServerToHistory(historyList, parseHistoryCallback)\n    },\n    () => {\n      $('.ui-signin').show()\n      $('.ui-or').show()\n      $('.ui-welcome').hide()\n      $('.ui-avatar').prop('src', '').hide()\n      $('.ui-name').html('')\n      $('.ui-signout').hide()\n      parseStorageToHistory(historyList, parseHistoryCallback)\n    }\n  )\n}\n\n$('.masthead-nav li').click(function () {\n  $(this).siblings().removeClass('active')\n  $(this).addClass('active')\n})\n\n// prevent empty link change hash\n$('a[href=\"#\"]').click(function (e) {\n  e.preventDefault()\n})\n\n$('.ui-home').click(function (e) {\n  if (!$('#home').is(':visible')) {\n    $('.section:visible').hide()\n    $('#home').fadeIn()\n  }\n})\n\n$('.ui-history').click(() => {\n  if (!$('#history').is(':visible')) {\n    $('.section:visible').hide()\n    $('#history').fadeIn()\n  }\n})\n\nfunction checkHistoryList () {\n  if ($('#history-list').children().length > 0) {\n    $('.pagination').show()\n    $('.ui-nohistory').hide()\n    $('.ui-import-from-browser').hide()\n  } else if ($('#history-list').children().length === 0) {\n    $('.pagination').hide()\n    $('.ui-nohistory').slideDown()\n    getStorageHistory(data => {\n      if (data && data.length > 0 && getLoginState() && historyList.items.length === 0) {\n        $('.ui-import-from-browser').slideDown()\n      }\n    })\n  }\n}\n\nfunction parseHistoryCallback (list, notehistory) {\n  checkHistoryList()\n  // sort by pinned then timestamp\n  list.sort('', {\n    sortFunction (a, b) {\n      const notea = a.values()\n      const noteb = b.values()\n      if (notea.pinned && !noteb.pinned) {\n        return -1\n      } else if (!notea.pinned && noteb.pinned) {\n        return 1\n      } else {\n        if (notea.timestamp > noteb.timestamp) {\n          return -1\n        } else if (notea.timestamp < noteb.timestamp) {\n          return 1\n        } else {\n          return 0\n        }\n      }\n    }\n  })\n  // parse filter tags\n  const filtertags = []\n  for (let i = 0, l = list.items.length; i < l; i++) {\n    const tags = list.items[i]._values.tags\n    if (tags && tags.length > 0) {\n      for (let j = 0; j < tags.length; j++) {\n        // push info filtertags if not found\n        let found = false\n        if (filtertags.includes(tags[j])) { found = true }\n        if (!found) { filtertags.push(tags[j]) }\n      }\n    }\n  }\n  buildTagsFilter(filtertags)\n}\n\n// update items whenever list updated\nhistoryList.on('updated', e => {\n  for (let i = 0, l = e.items.length; i < l; i++) {\n    const item = e.items[i]\n    if (item.visible()) {\n      const itemEl = $(item.elm)\n      const values = item._values\n      const a = itemEl.find('a')\n      const pin = itemEl.find('.ui-history-pin')\n      const tagsEl = itemEl.find('.tags')\n      // parse link to element a\n      a.attr('href', `${serverurl}/${values.id}`)\n      // parse pinned\n      if (values.pinned) {\n        pin.addClass('active')\n      } else {\n        pin.removeClass('active')\n      }\n      // parse tags\n      const tags = values.tags\n      if (tags && tags.length > 0 && tagsEl.children().length <= 0) {\n        const labels = []\n        for (let j = 0; j < tags.length; j++) {\n          // push into the item label\n          labels.push(`<span class='label label-default'>${tags[j]}</span>`)\n        }\n        tagsEl.html(labels.join(' '))\n      }\n    }\n  }\n  $('.ui-history-close').off('click')\n  $('.ui-history-close').on('click', historyCloseClick)\n  $('.ui-history-pin').off('click')\n  $('.ui-history-pin').on('click', historyPinClick)\n})\n\nfunction historyCloseClick (e) {\n  e.preventDefault()\n  const id = $(this).closest('a').siblings('span').html()\n  const value = historyList.get('id', id)[0]._values\n  $('.ui-delete-history-modal-msg').text('Do you really want to delete below history?')\n  $('.ui-delete-history-modal-item').html(`<i class=\"fa fa-file-text\"></i> ${value.text}<br><i class=\"fa fa-clock-o\"></i> ${value.time}`)\n  clearHistory = false\n  deleteId = id\n}\n\nfunction historyPinClick (e) {\n  e.preventDefault()\n  const $this = $(this)\n  const id = $this.closest('a').siblings('span').html()\n  const item = historyList.get('id', id)[0]\n  const values = item._values\n  let pinned = values.pinned\n  if (!values.pinned) {\n    pinned = true\n    item._values.pinned = true\n  } else {\n    pinned = false\n    item._values.pinned = false\n  }\n  checkIfAuth(() => {\n    postHistoryToServer(id, {\n      pinned\n    }, (err, result) => {\n      if (!err) {\n        if (pinned) { $this.addClass('active') } else { $this.removeClass('active') }\n      }\n    })\n  }, () => {\n    getHistory(notehistory => {\n      for (let i = 0; i < notehistory.length; i++) {\n        if (notehistory[i].id === id) {\n          notehistory[i].pinned = pinned\n          break\n        }\n      }\n      saveHistory(notehistory)\n      if (pinned) { $this.addClass('active') } else { $this.removeClass('active') }\n    })\n  })\n}\n\n// auto update item fromNow every minutes\nsetInterval(updateItemFromNow, 60000)\n\nfunction updateItemFromNow () {\n  const items = $('.item').toArray()\n  for (let i = 0; i < items.length; i++) {\n    const item = $(items[i])\n    const timestamp = parseInt(item.find('.timestamp').text())\n    item.find('.fromNow').text(moment(timestamp).fromNow())\n  }\n}\n\nlet clearHistory = false\nlet deleteId = null\n\nfunction deleteHistory () {\n  checkIfAuth(() => {\n    deleteServerHistory(deleteId, (err, result) => {\n      if (!err) {\n        if (clearHistory) {\n          historyList.clear()\n          checkHistoryList()\n        } else {\n          historyList.remove('id', deleteId)\n          checkHistoryList()\n        }\n      }\n      $('.delete-history-modal').modal('hide')\n      deleteId = null\n      clearHistory = false\n    })\n  }, () => {\n    if (clearHistory) {\n      saveHistory([])\n      historyList.clear()\n      checkHistoryList()\n      deleteId = null\n    } else {\n      if (!deleteId) return\n      getHistory(notehistory => {\n        const newnotehistory = removeHistory(deleteId, notehistory)\n        saveHistory(newnotehistory)\n        historyList.remove('id', deleteId)\n        checkHistoryList()\n        deleteId = null\n      })\n    }\n    $('.delete-history-modal').modal('hide')\n    clearHistory = false\n  })\n}\n\n$('.ui-delete-history-modal-confirm').click(() => {\n  deleteHistory()\n})\n\n$('.ui-import-from-browser').click(() => {\n  saveStorageHistoryToServer(() => {\n    parseStorageToHistory(historyList, parseHistoryCallback)\n  })\n})\n\n$('.ui-save-history').click(() => {\n  getHistory(data => {\n    const history = JSON.stringify(data)\n    const blob = new Blob([history], {\n      type: 'application/json;charset=utf-8'\n    })\n    saveAs(blob, `hedgedoc_history_${moment().format('YYYYMMDDHHmmss')}`, true)\n  })\n})\n\n$('.ui-open-history').bind('change', e => {\n  const files = e.target.files || e.dataTransfer.files\n  const file = files[0]\n  const reader = new FileReader()\n  reader.onload = () => {\n    const notehistory = JSON.parse(reader.result)\n    // console.log(notehistory);\n    if (!reader.result) return\n    getHistory(data => {\n      let mergedata = data.concat(notehistory)\n      mergedata = clearDuplicatedHistory(mergedata)\n      saveHistory(mergedata)\n      parseHistory(historyList, parseHistoryCallback)\n    })\n    $('.ui-open-history').replaceWith($('.ui-open-history').val('').clone(true))\n  }\n  reader.readAsText(file)\n})\n\n$('.ui-clear-history').click(() => {\n  $('.ui-delete-history-modal-msg').text('Do you really want to clear all history?')\n  $('.ui-delete-history-modal-item').html('There is no turning back.')\n  clearHistory = true\n  deleteId = null\n})\n\n$('.ui-refresh-history').click(() => {\n  const lastTags = $('.ui-use-tags').select2('val')\n  $('.ui-use-tags').select2('val', '')\n  historyList.filter()\n  const lastKeyword = $('.search').val()\n  $('.search').val('')\n  historyList.search()\n  $('#history-list').slideUp('fast')\n  $('.pagination').hide()\n\n  resetCheckAuth()\n  historyList.clear()\n  parseHistory(historyList, (list, notehistory) => {\n    parseHistoryCallback(list, notehistory)\n    $('.ui-use-tags').select2('val', lastTags)\n    $('.ui-use-tags').trigger('change')\n    historyList.search(lastKeyword)\n    $('.search').val(lastKeyword)\n    checkHistoryList()\n    $('#history-list').slideDown('fast')\n  })\n})\n\n$('.ui-delete-user-modal-cancel').click(() => {\n  $('.ui-delete-user').parent().removeClass('active')\n})\n\n$('.ui-logout').click(() => {\n  clearLoginState()\n  location.href = `${serverurl}/logout`\n})\n\nlet filtertags = []\n$('.ui-use-tags').select2({\n  placeholder: $('.ui-use-tags').attr('placeholder'),\n  multiple: true,\n  data () {\n    return {\n      results: filtertags\n    }\n  }\n})\n$('.select2-input').css('width', 'inherit')\nbuildTagsFilter([])\n\nfunction buildTagsFilter (tags) {\n  for (let i = 0; i < tags.length; i++) {\n    tags[i] = {\n      id: i,\n      text: S(tags[i]).unescapeHTML().s\n    }\n  }\n  filtertags = tags\n}\n$('.ui-use-tags').on('change', function () {\n  const tags = []\n  const data = $(this).select2('data')\n  for (let i = 0; i < data.length; i++) { tags.push(data[i].text) }\n  if (tags.length > 0) {\n    historyList.filter(item => {\n      const values = item.values()\n      if (!values.tags) return false\n      let found = false\n      for (let i = 0; i < tags.length; i++) {\n        if (values.tags.includes(tags[i])) {\n          found = true\n          break\n        }\n      }\n      return found\n    })\n  } else {\n    historyList.filter()\n  }\n  checkHistoryList()\n})\n\n$('.search').keyup(() => {\n  checkHistoryList()\n})\n\n// focus user field after opening login modal\n$('.signin-modal').on('shown.bs.modal', function () {\n  const fieldLDAP = $('input[name=username]')\n  const fieldEmail = $('input[name=email]')\n  const fieldOpenID = $('input[name=openid_identifier]')\n  if (fieldLDAP.length === 1) {\n    fieldLDAP.focus()\n  } else if (fieldEmail.length === 1) {\n    fieldEmail.focus()\n  } else if (fieldOpenID.length === 1) {\n    fieldOpenID.focus()\n  }\n})\n","// extracted by mini-css-extract-plugin\nexport {};"],"sourceRoot":""}